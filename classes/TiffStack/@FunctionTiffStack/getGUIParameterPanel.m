function [panel, getParameter] = getGUIParameterPanel(parent)
    
    panel = handle(uipanel( ...
        'Parent', parent, ...
        'BackgroundColor', get(parent, 'Color'), ...
        'Units', 'pixels', ...
        'BorderWidth', 0, ...
        'HandleVisibility', 'off' ...
    ));
    
    functionStrings = { ...
        'max - abs(image - median)', ...
        'max - image' ...
    };
    functions = { ...
        @medianBased, ...
        @inverted ...
    };

    funcInput = handle(uicontrol( ...
        'Parent', panel, ...
        'HandleVisibility', 'off', ...
        'Style', 'popupmenu', ...
        'String', functionStrings, ...
        'Value', 1 ...
    ));

    try
        addlistener(panel, 'SizeChanged', @arrange);
    catch
        addlistener(panel, 'SizeChange', @arrange);
    end

    function arrange(~,~)
        pos = panel.Position;
        lineHeight = (pos(4) - 5);
        controlWidth = pos(3) - 5;
        funcInput.Position = [5, 5, controlWidth, lineHeight];
    end
    getParameter = @readParameter;
    function param = readParameter()
        param = functions(funcInput.Value);
    end
    
    function img = medianBased(img, ~)
        img = double(img);
        med =  abs(img - median(img(:)));
        [min, max] = minmax(med);
        img = (max - med) ./ (max - min);
    end
    function img = inverted(img, ~)
        img = double(img);
        [min, max] = minmax(img(:));
        img = (max - img)./(max - min);
    end
end

